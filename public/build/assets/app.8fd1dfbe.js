import{_ as e,l as t}from"./lodash.a10a1929.js";import{a}from"./axios.98e08a26.js";import{$ as i}from"./jquery.dd257bdb.js";import{c as n,a as s,b as r,d as o,e as l}from"./yup.43c544e7.js";import{h as d}from"./moment.9709ab41.js";import{S as c}from"./swal.f7e1dfde.js";import{p as u,a as h}from"./pdfmake.92753e47.js";const m={},p=function(e,t,a){if(!t||0===t.length)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/build/"+e}(e))in m)return;m[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(a)for(let a=i.length-1;a>=0;a--){const n=i[a];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise(((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e()))};window._=e,window.axios=a,window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const g=e=>({margin:[40,50,40,0],stack:[{text:e,fontSize:14,bold:!0,alignment:"center"},{text:"Badan Pendapatan Daerah Kabupaten Bengkalis",fontSize:12,margin:[0,4,0,0],alignment:"center"},{alignment:"center",canvas:[{type:"line",x1:0,y1:10,x2:400,y2:10,lineWidth:1}]}]}),f=e=>{e.inner.forEach((e=>{const t=i(`#${e.path}`);t.addClass("is-invalid");const a=`\n            <div class="invalid-feedback">\n                ${e.message}\n            </div>\n        `;t.next().hasClass("invalid-feedback")&&t.next().remove(),t.after(a)}))};class b{constructor(){}init(){i("#form-login").on("submit",(e=>{this.initSubmit(e)})),i("#quick-fill").on("change",(e=>{const t=i(e.target).val();i('input[name="nip"]').val(t),i('input[name="password"]').val("12345")}))}initSubmit(e){e.preventDefault();const t=i(e.target).find("button[type=submit]"),a=i(e.target).serializeArray(),r={};a.forEach((e=>{r[e.name]=e.value;const t=i(`#${e.name}`);t.on("change",(()=>{t.removeClass("is-invalid"),t.next().remove()}))})),n().shape({nip:s().min(18,"NIP harus 18 karakter").required("NIP harus diisi"),password:s().required("Password harus diisi")}).validate(r,{abortEarly:!1}).then((a=>{t.attr("disabled",!0),t.html('\n                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                    Loading...\n                '),e.target.submit()})).catch((e=>{f(e)}))}}const k=n().shape({jenis_cuti:s().required("Jenis cuti harus dipilih"),bukti:r().test("required","Bukti harus diupload",(e=>!!e&&e.length>0)).test("filemime","Bukti harus berupa file PDF, JPG, JPEG, PNG",(e=>{if(e){const t=e.split(".").pop();return["pdf","jpg","jpeg","png"].includes(t)}return!1})),keterangan:s().required("Keterangan harus diisi"),dates:o().min(1,"Tanggal harus dipilih")}),v={language:{url:"//cdn.datatables.net/plug-ins/1.10.24/i18n/Indonesian.json"}},w=e=>c.fire({title:"Lanjutkan?",text:e,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Lanjutkan!"}),j=e=>c.fire({title:"Berhasil",text:e,icon:"success",confirmButtonText:"OK"}),D=(e,t,a="Ya, hapus",i)=>{p((()=>import("./swal.f7e1dfde.js").then((e=>e.s))),["assets/swal.f7e1dfde.js","assets/lodash.a10a1929.js"]).then((({default:n})=>{n.fire({title:e,text:t,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:a}).then((e=>{e.isConfirmed&&i(n)}))}))},x=e=>r().test("pdfOrImage","File harus berupa PDF atau gambar",(function(t){if(e)return!0;const{createError:a,path:i,resolve:n}=this,s=n(t).name.split(".").pop();return!!["pdf","jpg","jpeg","png","gif"].includes(s)||a({path:i,message:"File harus berupa PDF atau gambar"})}));u.addVirtualFileSystem(h);const y=e=>c.fire({title:"Berhasil!",text:e,icon:"success"}),P=e=>c.fire({title:"Lanjutkan?",text:e,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, lanjutkan!",cancelButtonText:"Tidak"}),_={language:{url:"//cdn.datatables.net/plug-ins/1.10.24/i18n/Indonesian.json"}};u.addVirtualFileSystem(h);const C=[{path:"",pathRegex:/^\/$/g,exact:!0,class:b},{path:"auth",pathRegex:/auth/g,class:b},{path:"panel/absensi/riwayat",pathRegex:/panel\/absensi\/riwayat/g,class:class{constructor(){this.state={},this.data=[],this.init()}init(){var e;i(".data-container").each(((e,t)=>{const a=i(t).data();Object.entries(a).forEach((([e,t])=>{this.state[e]=t}))})),this.state.currentUrl&&(e=this.state.currentUrl,new Promise((t=>i.getJSON(`${e}?mode=json`,(e=>{t(e)}))))).then((e=>{this.data=e.absensi||[]})),i("#print-all").on("click",(()=>{this.printAll()})),i(".btn-print-detail").on("click",(e=>{const t=i(e.currentTarget).data("id");this.printDetail(t)}))}printAll(){const e=["Tanggal","Jam Masuk","Jam Keluar","Total Jam","Keterangan"].map((e=>({text:e,style:"tableHeader"}))),a=this.data.map((e=>{const{formatted_tanggal:t,formatted_waktu_masuk:a,formatted_waktu_keluar:i,total_jam:n,status:s}=e;return[t,a,i,n,s]})),i=t.exports.get(this.data,"[0].user.nama","Pegawai"),n={pageSize:"A4",pageMargins:[40,120,40,60],header:g(`Laporan Absensi - ${i}`),content:{stack:[{columns:[{canvas:[{type:"line",x1:0,y1:0,x2:0,y2:75,lineWidth:1}],width:10},{stack:[{text:`Nama: ${i}`,style:"userInfo"},{text:`NIP: ${t.exports.get(this.data,"[0].user.nip","NIP")}`,style:"userInfo"},{text:`Jabatan: ${t.exports.get(this.data,"[0].user.jabatan","Jabatan")} - ${t.exports.get(this.data,"[0].user.bidangs.nama","")}`,style:"userInfo"}]}],margin:[0,0,0,15]},{style:"tableExample",table:{headerRows:1,widths:Array(5).fill(95),heights:[20,20,20,20,20],body:[e,...a]}}]},styles:{tableExample:{margin:[0,5,0,15]},tableHeader:{bold:!0,fontSize:13,color:"black"},userInfo:{fontSize:12,margin:[0,5,0,5]}}};pdfMake.createPdf(n).open()}printDetail(e){const a=this.data.find((t=>t.id===e)),i={content:[{text:"Detail Absensi Pegawai",style:"header"},{style:"tableExample",table:{headerRows:1,widths:[120,"*"],heights:[20,20,20,20,20],body:[[{text:"Detail Pegawai",style:"tableHeader",colSpan:2,alignment:"center",margin:[0,15]},{}],["Nama",t.exports.get(a,"user.nama","")],["NIP",t.exports.get(a,"user.nip","")],["Jabatan",t.exports.get(a,"user.jabatan","")],["Bidang",t.exports.get(a,"user.bidangs.nama","")],[{text:"Detail Absensi",style:"tableHeader",colSpan:2,alignment:"center",margin:[0,15]},{}],["Tanggal",t.exports.get(a,"formatted_tanggal","")],["Waktu Masuk",t.exports.get(a,"formatted_waktu_masuk","")],["Waktu Keluar",t.exports.get(a,"formatted_waktu_keluar","")],["Shift",t.exports.get(a,"formatted_shift","")],["Total Jam",t.exports.get(a,"total_jam","")],["Lokasi Masuk",t.exports.get(a,"lokasi_masuk","")],["Lokasi Keluar",t.exports.get(a,"lokasi_keluar","")],["Jarak Masuk",t.exports.get(a,"jarak_masuk","")],["Jarak Keluar",t.exports.get(a,"jarak_keluar","")],["Status",t.exports.get(a,"status","")]]}}],styles:{header:{fontSize:18,bold:!0,alignment:"center",margin:[0,5,0,15]},tableExample:{margin:[0,5,0,15]},tableHeader:{bold:!0,fontSize:13,color:"black"}}};pdfMake.createPdf(i).open()}}},{path:"panel/jam_kerja",pathRegex:/panel\/jam_kerja/g,class:class{constructor(){this.state={}}init(){$(".data-container").each(((e,t)=>{const a=$(t).data();Object.entries(a).forEach((([e,t])=>{this.state[e]=t}))})),this.initForm(),$(".btn-delete").on("click",(e=>{const t=$(e.currentTarget).data("id");this.delete(t)})),$(".btn-edit").on("click",(e=>{const t=$(e.currentTarget).data("id");this.edit(t)})),$(".switch-status").on("change",(e=>{const t=$(e.currentTarget).data("id"),a=$(e.currentTarget).prop("checked")?"aktif":"nonaktif";this.switchStatus(t,a)}))}initForm(){const e=$("#modal-form form");$("[name='days[]']").select2(),e.on("submit",(t=>{t.preventDefault();const a=["_token","_method"],i=e.serializeArray().reduce(((e,t)=>(a.includes(t.name)||(e[t.name]=t.value),e)),{});$(".form-group").removeClass("has-error"),$("input, select").removeClass("is-invalid"),$(".form-group .invalid-feedback").remove(),n().shape({"days[]":s().required("Pilih hari kerja"),keterangan:s().required("Keterangan harus diisi"),selesai:s().required("Jam selesai harus diisi").test("test","Jam selesai harus lebih besar dari jam mulai",(function(e){return e>this.parent.mulai})),mulai:s().required("Jam mulai harus diisi")}).validate(i).then((()=>{e[0].submit()})).catch((t=>{const{path:a,message:i}=t,n=e.find(`[name="${a}"]`).closest(".form-group");n.addClass("has-error");const s=`<div class="invalid-feedback">${i}</div>`;n.append(s)}))}))}delete(e){D("Hapus jam kerja","Apakah anda yakin ingin menghapus jam kerja ini?","Ya, hapus!",(()=>{const{currentUrl:t,token:a}=this.state,i=`${t}/${e}`,n={_token:a,_method:"DELETE"};$.ajax({url:i,method:"POST",data:n,success:e=>{"success"===e.status?(c.fire("Berhasil","Jam kerja berhasil dihapus","success"),window.location.reload()):c.fire("Gagal","Jam kerja gagal dihapus","error")},error:e=>{c.fire("Gagal","Jam kerja gagal dihapus","error")}})}))}switchStatus(e,t){const{currentUrl:a,token:i}=this.state,n=`${a}/${e}?update=status`,s={_token:i,_method:"PUT",status:t};$.ajax({url:n,method:"POST",data:s,success:e=>{},error:e=>{}})}}},{path:"panel/izin",pathRegex:/panel\/izin/g,class:class{constructor(){this.state={},this.data=[],document.addEventListener("livewire:load",(()=>{this.initLivewire()}))}initLivewire(){const e=window.livewire;e.on("initDataTable",(()=>{$("table").DataTable(_)})),e.on("successAddIzin",(()=>{y("Pengajuan izin berhasil ditambahkan").then((()=>{window.location.reload()}))})),e.on("successUpdateIzin",(()=>{y("Pengajuan izin berhasil diubah").then((()=>{window.location.reload()}))})),e.on("deleteIzin",(t=>{P("Pengajuan izin akan dihapus").then((a=>{a.value&&e.emit("procceedDeleteIzin",t)}))})),e.on("accIzin",(t=>{P("Pengajuan izin akan disetujui").then((a=>{a.value&&e.emit("procceedAccIzin",t)}))})),e.on("rejectIzin",(t=>{P("Pengajuan izin akan ditolak").then((a=>{a.value&&e.emit("procceedRejectIzin",t)}))})),e.on("success",(e=>{y(e).then((()=>{window.location.reload()}))}))}init(){$(".data-container").each(((e,t)=>{const a=$(t).data();Object.entries(a).forEach((([e,t])=>{this.state[e]=t}))})),this.fetchData(),this.isEdit=!1,this.initForm(),this.initEditForm(),this.initTableActions(),$("#btn-cancel-incoming").on("click",(e=>{const t=$(e.target).data().id;this.delete(t)}))}initTableActions(){$(".btn-track").on("click",(e=>{const t=$(e.target).data().tracking||[];this.renderTracking(t)})),$(".btn-delete").on("click",(e=>{const t=$(e.target).data().id;this.delete(t)})),$(".acc-izin").on("click",(e=>{const t=$(e.target).data().id;this.accIzin(t)})),$(".reject-izin").on("click",(e=>{const t=$(e.target).data().id;this.rejectIzin(t)})),$(".print-izin").on("click",(e=>{const t=$(e.target).data().id;this.print(t)}))}initEditForm(){const e=`${this.state.baseUrl}/panel/izin/`,a=$(".btn-edit"),i=$("#form-add"),n=$(".modal-title"),s=$("[type=submit]"),r=i.find("input, select");a.on("click",(a=>{const o=$(a.target).data().item||{};r.each(((e,a)=>{const i=$(a),n=i.attr("name"),s=i.attr("type"),r=t.exports.get(o,n,"");if("_token"!==n)if("file"===s){const e=`<div class="text-muted file-edit-value">${r}</div>`;i.next().hasClass("file-edit-value")&&i.next().remove(),i.after(e)}else i.val(r)}));const l=o.id;i.attr("action",`${e}${l}`),i.find("input[name=_method]").length?i.find("input[name=_method]").remove():i.append('<input type="hidden" name="_method" value="PUT">'),n.text("Edit Izin"),s.text("Update"),this.isEdit=!0})),$("#modal-form").on("hidden.bs.modal",(function(e){n.text("Tambah Pengajuan"),s.text("Ajukan"),$(".invalid-feedback").remove(),$(".is-invalid").removeClass("is-invalid"),$(".text-muted").remove(),$(".file-edit-value").remove(),i[0].reset(),i.attr("action",this.state.baseURL),this.isEdit=!1}))}initForm(){$(".form-control, .form-control-file").on("change keyup",(e=>{const t=$(e.target);t.hasClass("is-invalid")&&t.removeClass("is-invalid"),t.next().hasClass("invalid-feedback")&&t.next().remove()})),$("#jenis").on("change",(e=>{const t=$(e.target).val(),a=$("#jenis-lainnya");if("Lainnya"===t){const e='\n                    <div class="form-group">\n                        <label for="jenis-lainnya">Jenis Lainnya</label>\n                        <input type="text" name="jenis_lainnya" id="jenis-lainnya" required class="form-control" placeholder="Jenis Lainnya">\n                    </div>\n                ';a.append(e)}else a.empty()})),$("#form-add").on("submit",(e=>{e.preventDefault(),this.add(e)}))}fetchData(){const e=new URL(window.location.href),t=new URLSearchParams(e.search);t.set("mode","json");const a=`${this.state.currentUrl}?${t.toString()}`;$.getJSON(a,(e=>{this.state.data=e}))}add(e){const t=new FormData(e.target),a=Object.fromEntries(t.entries());n().shape({jenis:s().required("Jenis izin harus diisi"),jenis_lainnya:s().when("jenis",{is:"Lainnya",then:s().required("Jenis lainnya harus diisi")}),tgl_mulai:l().required("Tanggal mulai harus diisi"),tgl_selesai:l().required("Tanggal selesai harus diisi"),keterangan:s().min(10,"Keterangan minimal 10 karakter").required("Keterangan harus diisi"),bukti:x(this.isEdit).test("required","Bukti harus diisi",(e=>!!this.isEdit||e.size>0))}).validate(a,{abortEarly:!1}).then((()=>{e.target.submit()})).catch((e=>{f(e)}))}delete(e){p((()=>import("./swal.f7e1dfde.js").then((e=>e.s))),["assets/swal.f7e1dfde.js","assets/lodash.a10a1929.js"]).then((t=>{t.default.fire({title:"Apakah anda yakin?",text:"Data tidak dapat dikembalikan setelah dihapus",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus!"}).then((t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=`/panel/izin/${e}`;const a={_method:"DELETE",_token:this.state.token};Object.keys(a).forEach((e=>{const i=document.createElement("input");i.type="hidden",i.name=e,i.value=a[e],t.appendChild(i)})),document.body.appendChild(t),t.submit()}}))}))}accIzin(e){D("Terima pengajuan ini?",'Pengajuan akan diterima dan status akan berubah menjadi "Diterima"',"Ya, terima!",(i=>{const n=this.state.currentUrl;let s=`accepted_${this.state.role}`;"atasan"===this.state.role&&(s=s.replace("atasan","pimpinan"));const r={_method:"put",_token:this.state.token,status:s};a.post(`${n}/update_status/${e}`,r).then((e=>{"success"===t.exports.get(e,"data.status")?i.fire({title:"Berhasil!",text:"Pengajuan berhasil diterima",icon:"success"}).then((()=>{window.location.reload()})):i.fire({title:"Gagal!",text:"Pengajuan gagal diterima",icon:"error"})}))}))}rejectIzin(e){D("Tolak pengajuan ini?","Pengajuan akan ditolak dan status akan berubah menjadi 'Ditolak'","Ya, tolak!",(i=>{const n=this.state.currentUrl,s={_method:"put",_token:this.state.token,status:"rejected"};a.post(`${n}/update_status/${e}`,s).then((e=>{"success"===t.exports.get(e,"data.status")?i.fire({title:"Berhasil!",text:"Pengajuan berhasil ditolak",icon:"success"}).then((()=>{window.location.reload()})):i.fire({title:"Gagal!",text:"Pengajuan gagal ditolak",icon:"error"})}))}))}renderTracking(e=[]){const t=e.map((e=>`<div class="tracking-item">\n                <div class="tracking-icon status-intransit">\n                    <svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">\n                        <path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path>\n                    </svg>\n                </div>\n                <div class="tracking-date">${d(e.date).format("DD MMMM YYYY")}<span>${d(e.date).format("HH:mm [WIB]")}</span></div>\n                <div class="tracking-content">${e.status.toString().toUpperCase()}</div>\n            </div>`)).join("");$("#tracking-list").html(t)}print(e){const a=this.state.data.find((t=>t.id===e)),i=[["Nama",a.user.nama],["NIP",a.user.nip],["Jabatan",`${a.user.jabatan} ${t.exports.get(a,"user.bidangs.nama")}`],["Golongan",a.user.golongan],["Jenis Izin",a.jenis],["Tanggal Mulai",a.formatted_tgl_mulai],["Tanggal Selesai",a.formatted_tgl_selesai],["Durasi",a.formatted_durasi],["Keterangan",a.keterangan],["Status",a.status.text]].map((e=>[{text:e[0],style:"tableHeader"},{text:e[1],style:"tableContent"}])),n={pageSize:"A4",pageOrientation:"portrait",pageMargins:[40,120,40,60],header:g("Detail Pengajuan Izin"),content:[{style:"tableExample",table:{widths:["auto","*"],heights:[20,20,20,20,20,20,20,20,20,20],body:i}}],styles:{tableHeader:{bold:!0,fontSize:12,color:"black"},tableContent:{fontSize:12,color:"black"}}};u.createPdf(n).open()}}},{path:"panel/cuti",pathRegex:/panel\/cuti/g,class:class{constructor(){this.state={},this.data={},this.initLivewire(),this.init()}initLivewire(){const e=window.Livewire;e.on("initDataTable",(()=>{$(".datatable").DataTable(v)})),e.on("acc",(t=>{w("Data cuti akan di ACC").then((a=>{a.isConfirmed&&e.emit("accCuti",t)}))})),e.on("rej",(t=>{w("Data cuti akan ditolak").then((a=>{a.isConfirmed&&e.emit("rejectCuti",t)}))})),e.on("successAccCuti",(()=>{j("Data cuti berhasil di ACC")})),e.on("successRejectCuti",(()=>{j("Data cuti berhasil ditolak")})),e.on("delete",(t=>{w("Data cuti akan dihapus").then((a=>{a.isConfirmed&&e.emit("deleteCuti",t)}))})),e.on("successDeleteCuti",(()=>{c.fire({title:"Berhasil",text:"Data cuti berhasil dihapus",icon:"success",confirmButtonText:"OK"}).then((()=>{window.location.reload()}))})),e.on("rerenderDatePicker",(e=>{this.renderMultiDatePicker(e)}))}init(){$(".data-container").each(((e,t)=>{const a=$(t).data();Object.entries(a).forEach((([e,t])=>{this.state[e]=t}))})),this.state.currentUrl&&this.getData(),window.Livewire.on("cutiSubmitted",(e=>{c.fire({title:"Berhasil",text:e?"Data cuti berhasil diubah":"Data cuti berhasil ditambahkan",icon:"success",confirmButtonText:"OK"}).then((()=>{window.location.reload()}))}));const e=document.querySelector("#tanggal");window.Livewire.on("changeTanggal",(t=>{e.value=t,e.dispatchEvent(new Event("input"))})),$("#modal-form").on("show.bs.modal",(()=>{this.renderMultiDatePicker()})),$("#modal-form").on("hidden.bs.modal",(function(e){$("#ctmdp").multiDatesPicker("resetDates","picked"),$("input").val("")}))}initModalForm(){document.querySelector("#jcf-selector").addEventListener("change",(e=>{const t=e.target.selectedOptions[0].dataset.value;$("#jcf-value").text(t),this.jatahCuti=t;const a=$("#ctmdp").multiDatesPicker("getDates");if(a.length>this.jatahCuti){c.fire("Gagal","Jumlah hari yang dipilih melebihi jatah cuti","error");const e=a.slice(0,this.jatahCuti);$("#ctmdp").multiDatesPicker("resetDates","picked"),$("#ctmdp").multiDatesPicker("addDates",e)}})),$("#modal-form").on("show.bs.modal",(()=>{const e=$("#jcf-selector").find(":selected").data();this.jatahCuti=e.value;const t=d(),a=d().endOf("year"),i={beforeShowDay:$.datepicker.noWeekends,minDate:1,maxDate:a.diff(t,"days"),autoSize:!0,onSelect:(e,t)=>{$("#ctmdp").multiDatesPicker("getDates").length>this.jatahCuti&&(c.fire("Gagal","Jumlah hari yang dipilih melebihi jatah cuti","error"),$("#ctmdp").multiDatesPicker("removeDates",new Date(e)))}};(this.data.disable_dates||[]).length>0&&(i.addDisabledDates=this.data.disable_dates),$("#ctmdp").multiDatesPicker(i)})),$("#modal-form").on("hidden.bs.modal",(function(e){$("#ctmdp").multiDatesPicker("resetDates","picked"),$("input").val("")}));const e=$("button[type='submit']"),t=$('button[data-dismiss="modal"]');e.on("click",(a=>{const i=$("#jcf-selector").val(),n=$("#ctmdp").multiDatesPicker("getDates"),s=$("#keterangan").val(),r=$("#bukti").val();$(".invalid-feedback").remove(),$(".form-group").removeClass("has-error"),$("input").removeClass("is-invalid"),k.validate({jenis_cuti:i,keterangan:s,dates:n,bukti:r}).then((a=>{e.attr("disabled",!0),e.text("Loading..."),t.attr("disabled",!0),$(".modal-backdrop").off("click");const i=this.populateFormData(a),n=document.querySelector("#bukti");n.files.length>0&&i.append("bukti",n.files[0]);const{currentUrl:s}=this.state;$.ajax({url:s,type:"POST",data:i,processData:!1,contentType:!1,success:e=>{"error"!==e.status?(c.fire("Berhasil","Pengajuan cuti berhasil dibuat.","success"),$("#modal-form").modal("hide"),location.reload()):c.fire("Gagal",e.message,"error")},error:e=>{c.fire("Gagal","Pengajuan cuti gagal dibuat.","error")},complete:()=>{e.attr("disabled",!1),e.text("Submit"),t.attr("disabled",!1)}})})).catch((e=>{const t=e.path;let a=$(`#${t}`).closest(".form-group");"dates"===t&&(a=$("#ctmdp").closest(".form-group"));const i=$(`#${t}`),n=`<div class="invalid-feedback">${e.message}</div>`;i.addClass("is-invalid"),a.addClass("has-error"),a.append(n)}))}))}getData(){const{currentUrl:e}=this.state;$.getJSON(`${e}?mode=json`,(e=>{this.data=e}))}populateFormData(e){const{idUser:t,token:a}=this.state,i=e.dates.map((e=>d(e).format("YYYY-MM-DD"))),n=i.length,s=i.join(","),r=[{status:"Pengajuan dibuat.",date:d().format("YYYY-MM-DD HH:mm:ss")}],o={_token:a,id_user:t,jenis:e.jenis_cuti,keterangan:e.keterangan,tanggal:s,tracking:JSON.stringify(r),total:n,status:"pending"},l=new FormData;return Object.entries(o).forEach((([e,t])=>{l.append(e,t)})),l}clearIfMoreThanJatahCuti(e){const t=$("#ctmdp").multiDatesPicker("getDates");if(t.length>e)return c.fire("Gagal","Jumlah hari yang dipilih melebihi jatah cuti","error"),$("#ctmdp").multiDatesPicker("removeDates",t),void window.Livewire.emit("changeTanggal","")}renderMultiDatePicker(e){const t=$("#jatah-cuti-value").text(),a=d(),i=d().endOf("year"),n={beforeShowDay:$.datepicker.noWeekends,minDate:1,maxDate:i.diff(a,"days"),autoSize:!0,onSelect:(e,a)=>{const i=$("#ctmdp").multiDatesPicker("getDates");i.length,this.clearIfMoreThanJatahCuti(t),window.Livewire.emit("changeTanggal",i)}};(this.data.disable_dates||[]).length>0&&(n.addDisabledDates=this.data.disable_dates),e&&this.clearIfMoreThanJatahCuti(e),$("#ctmdp").multiDatesPicker(n),window.Livewire.on("fillDatePicker",(e=>{const t=e.split(",").map((e=>new Date(e)));$("#ctmdp").multiDatesPicker("resetDates","picked"),$("#ctmdp").multiDatesPicker("addDates",t)}))}}},{path:"panel/report",pathRegex:/panel\/report/g,class:class{constructor(){}initLivewire(){}init(){$(".data-container").each(((e,t)=>{const a=$(t).data();Object.entries(a).forEach((([e,t])=>{this.state[e]=t}))})),this.renderByJenisData(),$("#jenis-data").on("change",(e=>{const t=e.target.value;this.dataType=t,this.renderByJenisData()})),$("#btn-print").on("click",(()=>{this.print()}))}initInputs(){$(".multiselect").each((function(){$(this).select2({width:"100%",placeholder:`Pilih ${$(this).data("label")}...`})})),$(".drPicker").daterangepicker({autoUpdateInput:!1,locale:{cancelLabel:"Clear",format:"DD/MM/YYYY"}}),$(".drPicker").on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("DD/MM/YYYY")+" - "+t.endDate.format("DD/MM/YYYY"))}))}renderByJenisData(){const e=$("#render-by-jenis-data");switch(this.dataType){case"pegawai":this.inputIds=["pegawai-select"],e.html(this.renderPegawai());break;case"absensi":case"dinas-luar":this.inputIds=["pegawai-select","range"],e.html(this.renderPegawaiAndRange());break;case"izin":this.inputIds=["pegawai-select","range","jenis-izin"],e.html(this.getTemplateIzin());break;case"cuti":this.inputIds=["pegawai-select","range","jenis-cuti"],e.html(this.getTemplateCuti())}this.initInputs()}renderPegawai(){return`<div class="form-group mb-3">\n            <label for="pegawai">Pilih Pegawai</label>\n            <select class="form-control multiselect" name="pegawai[]" id="pegawai-select" multiple data-label="Pegawai" data-item="pegawai">\n            ${this.state.pegawai.map((e=>`<option value="${e.id}">${e.nama}</option>`)).join("")}\n            </select>\n        </div>`}renderPegawaiAndRange(){return`<div>\n            ${this.renderPegawai()}\n            <div class="form-group">\n                <label for="range-absensi">Range Tanggal</label>\n                <input type="text"\n                    class="form-control drPicker" name="range-absensi" id="range" data-label="Range" aria-describedby="helpId" placeholder="Range Tanggal...">\n            </div>\n        </div>`}getTemplateIzin(){return`<div>\n            ${this.renderPegawaiAndRange()}\n            <div class="form-group">\n                <label for="jenis-izin">Jenis</label>\n                <select name="jenis-izin[]" id="jenis-izin" class="form-control multiselect" multiple data-label="Jenis Izin">\n                    <option value="Sakit">Sakit</option>\n                    <option value="Urusan Keluarga">Urusan Keluarga</option>\n                    <option value="Lainnya">Lainnya</option>\n                </select>\n            </div>\n        </div>`}getTemplateCuti(){return`<div>\n            ${this.renderPegawaiAndRange()}\n            <div class="form-group">\n                <label for="jenis-cuti">Jenis</label>\n                <select name="jenis-cuti" id="jenis-cuti" class="form-control multiselect" data-label="Jenis Cuti" multiple>\n                    <option value="tahunan">Cuti Tahunan</option>\n                    <option value="besar">Cuti Besar</option>\n                    <option value="melahirkan">Cuti Melahirkan</option>\n                    <option value="penting">Cuti Alasan Penting</option>\n                    <option value="ctln">Cuti Diluar Tanggungan Negara</option>\n                </select>\n            </div>\n        </div>`}getImageBase64(e){if(null===e||""===e)return"";const t=this.state.currentUrl+"/get_image_base64/"+e;return $.ajax({url:t,type:"GET",dataType:"json",success:function(e){return e},error:function(e){}})}print(){const e=this.inputIds;let t=!0;if(e.forEach((e=>{const a=$(`#${e}`);if(null===a.val()||""===a.val()){a.addClass("is-invalid");const e=`<div class="invalid-feedback">Field ${a.data("label")} tidak boleh kosong</div>`;0===a.parent().find(".invalid-feedback").length||a.parent().find(".invalid-feedback").remove(),a.parent().append(e),t=!1}else a.removeClass("is-invalid")})),t){const t={_method:"POST",_token:this.state.token,filter:this.dataType};e.forEach((e=>{const a=$(`#${e}`);t[e]=a.val()}));const a=this.state.currentUrl;$.post(a,t,(e=>{const t=e||[];this.printByJenisData(t)}))}}printByJenisData(e){switch(this.dataType){case"pegawai":this.printPegawai(e);break;case"absensi":this.printAbsensi(e)}}async printPegawai(e){const t=await Promise.all(e.map(((e,t)=>[[`#${t+1}`,""],["Nama",e.nama],["NIP",e.nip],["Jabatan",e.jabatan],["Bidang",e.bidangs.nama],["Golongan",e.golongan],["Jatah Cuti",e.jatah_cuti],["Tanggal Lahir",e.tgl_lahir],["Jenis Kelamin",e.jk],["Alamat",e.alamat],["No. Telp",e.no_telp],[{text:" ",colSpan:2,margin:[0,20,0,0]}]])).flat()),a={pageSize:"A4",pageMargins:[40,100,40,60],header:g("Laporan Data Pegawai"),content:[{layout:"lightHorizontalLines",table:{headerRows:1,widths:[100,"*"],heights:Array(t.length).fill(20),margin:[0,20,0,20],body:t}}],styles:{tableHeader:{bold:!0,fontSize:13,color:"black"}}};u.createPdf(a).open()}printAbsensi(e){e.map(((e,t)=>[]))}}}];!function(){!async function(){i(".data-container").toArray().forEach((async e=>{const t=i(e).data(),{successFlashdata:a,errorFlashdata:n,errors:s}=t,r=await p((()=>import("./swal.f7e1dfde.js").then((e=>e.s))),["assets/swal.f7e1dfde.js","assets/lodash.a10a1929.js"]);a?r.default.fire({icon:"success",title:"Berhasil",text:a}):n?r.default.fire({icon:"error",title:"Gagal",text:n}):s&&s.forEach((e=>{r.default.fire({icon:"error",title:"Gagal",text:e})}))}))}();const e=window.location.pathname+window.location.search,t=C.find((t=>t.exact?t.path===e:t.pathRegex.test(e)));t&&("admin"===i("[data-role]").data("role")&&t.adminClass?new t.adminClass:new t.class)}();
